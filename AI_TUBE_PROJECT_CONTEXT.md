🛰️ AI.Tube 项目 Master 开发规划与真理文档 (2025-12-30 23:30 最终修正版)🛠️ 一、 协作铁律 (The Iron Rules)1. 单文件修改：必须由用户发送完整代码 -> AI 确认后回复修改后的完整代码。2. 多文件联动：采取**“分步接力式”**修改。3. 同步机制：每日重大修改完结，AI 必须主动提醒用户同步此文档。4. Git 指令跟进 (中文化标准)：AI 必须在回复末尾附上 Git 同步指令，并提供中文注释说明。5. 验收归档闭环：AI 提供代码 -> 用户实测通过 -> 用户确认 -> AI 更新文档 -> 进入下一阶段。🎯 二、 核心愿景与战略 (Core Vision)• 定位：全球领先的 AI 原生视频创作社区。• 核心支柱：灵感 (Inspiration) / 商业 (Business) / 学习 (Academy)。🏗️ 三、 板块布局与逻辑架构 (System Architecture)路由与功能分布• / : 首页 (瀑布流 + 筛选)。• /tools/characters : [已上线] 角色资产库。含角色编辑、Prompt 配置、参考图画廊。• /tools/cineflow : [核心] 分镜生成器 (集成最新 AIGC 引擎)。• /tools : 工具库入口。• /vip : 会员专区。• /admin : 管理后台。技术栈核心• Image Processing: Sharp (Node.js) [新增] - 服务端物理裁剪引擎。• AI Engine: Doubao-Seedream-4.5 (Vision) + Seedream-3.0 (T2I) + 智能提示词工程。🚀 六、 开发进度追踪 (Current Progress)✅ 今日完成工作 (Milestones - 2025/12/30)1. AIGC 核心引擎 V2.1 (The "Ghost Face" Battle)针对“局部特写强制出人脸”和“特征污染”问题，完成了底层逻辑重构：• 物理层：服务端裁剪 (Sharp Integration)• 集成 sharp 库，配合 Vision 坐标，在“全景转特写”时物理切除无效像素（如腿部），阻断 AI 联想。• 逻辑层：熔断式语义隔离 (Semantic Fuse)• 中英文双语识别：修复了 isNonFaceDetail 无法识别中文“脚/手”的 Bug。• Hard Reset 策略：当识别到“脚/手/键盘”等局部特写时，物理清空角色描述词，并应用 (strictly no people:2.0) 高权重负面指令。• 特征层：智能清洗 (Feature Scrubbing)• 针对眼部/面部微距特写，实现了特征清洗算法 cleanVisualFeatures。• 在保留瞳色/发色的同时，自动过滤参考图中的“裙子、制服、袜子”等衣物标签，解决了“眼球里长裙子”的特征污染问题。2. 基础设施• 角色库 UI 确认：/tools/characters 界面已就绪，包含多参考图管理功能。• 存储优化：修复了 RLS 权限及中文文件名上传问题。🚩 待解决与后续计划 (To-Dos)[明日重点] 角色库功能升级 (Character Library Upgrade)既然 UI 已经有了，明天的重点从“开发”转为**“接入与增强”**：1. 字段扩展：• 在现有的“编辑角色”弹窗中，新增 “负面提示词 (Negative Prompt)” 配置字段。• 目的：允许为特定角色（如 lili）配置永久屏蔽词（e.g., "glasses, hat"），避免每次生图都要手动加。2. 引擎接入：• 修改 actions/generate.ts，使其在读取角色信息时，不仅读取 description，还能自动挂载该角色的 negative_prompt。3. 参考图画廊联动：• 研究如何在 CineFlow 分镜编辑器中，直接从这个“参考图画廊”里选择图片，而不是每次都重新上传。
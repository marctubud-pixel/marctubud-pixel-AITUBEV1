{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 238, "column": 0}, "map": {"version":3,"sources":["file:///Users/marc/AITUBE-NEW/marctubud-pixel-AITUBEV1/app/actions/director.ts"],"sourcesContent":["'use server'\n\nimport { GoogleGenAI, Type, Schema } from \"@google/genai\";\nimport { setGlobalDispatcher, ProxyAgent } from 'undici';\n\n// ============================================================\n// ğŸ”¥ å¼ºåˆ¶ä»£ç†è¡¥ä¸ (ä¿ç•™ä½ çš„é…ç½®)\n// ============================================================\nif (process.env.NODE_ENV === 'development') {\n  try {\n    const proxyUrl = 'http://127.0.0.1:7890';\n    const dispatcher = new ProxyAgent(proxyUrl);\n    setGlobalDispatcher(dispatcher);\n  } catch (err) {\n    console.error('ä»£ç†è®¾ç½®å¤±è´¥:', err);\n  }\n}\n\nconst ai = new GoogleGenAI({ \n  apiKey: process.env.GOOGLE_API_KEY\n});\n\n// âœ… æ›´æ–°æ•°æ®ç»“æ„ï¼šå¢åŠ  svgCode å­—æ®µ\nexport interface ScriptBreakdown {\n  panels: {\n    sceneNumber: string;\n    description: string;\n    shotType: string;\n    visualPrompt: string;\n    svgCode: string; // æ–°å¢ï¼šSVG ä»£ç å­—ç¬¦ä¸²\n  }[];\n}\n\nexport const analyzeScript = async (script: string): Promise<ScriptBreakdown> => {\n  const model = \"gemini-2.0-flash-exp\"; \n  \n  // âœ… æ ¸å¿ƒä¿®æ”¹ï¼šè®© AI å­¦ä¼šå†™ SVG\n  const systemInstruction = `\n    You are a professional storyboard artist. Analyze the script and break it down into 4 key visual panels.\n    \n    For each panel:\n    1. Determine the Shot Type (CS, MS, LS).\n    2. Write a Stable Diffusion prompt.\n    3. **CRITICAL TASK**: Generate a simple, abstract SVG string (<svg>...</svg>) to represent the COMPOSITION and BLOCKING of the shot.\n       - Use a 16:9 viewBox=\"0 0 160 90\".\n       - Use simple strokes (black) and no fill (or white fill) to mimic a rough pencil sketch.\n       - Use rectangles/circles to represent characters and lines for perspective/background.\n       - Keep the SVG code concise (under 500 characters if possible).\n       - Do NOT use markdown code blocks for the SVG, just the raw string.\n  `;\n\n  const responseSchema: Schema = {\n    type: Type.OBJECT,\n    properties: {\n      panels: {\n        type: Type.ARRAY,\n        items: {\n          type: Type.OBJECT,\n          properties: {\n            sceneNumber: { type: Type.STRING },\n            description: { type: Type.STRING },\n            shotType: { type: Type.STRING },\n            visualPrompt: { type: Type.STRING },\n            svgCode: { type: Type.STRING }, // å‘Šè¯‰ AI è¿”å›è¿™ä¸ªå­—æ®µ\n          },\n          required: [\"sceneNumber\", \"description\", \"shotType\", \"visualPrompt\", \"svgCode\"],\n        },\n      },\n    },\n    required: [\"panels\"],\n  };\n\n  try {\n    const response = await ai.models.generateContent({\n      model,\n      contents: `Analyze this script: \"${script}\"`,\n      config: {\n        systemInstruction,\n        responseMimeType: \"application/json\",\n        responseSchema,\n      },\n    });\n\n    if (!response.text) throw new Error(\"Gemini æ²¡æœ‰è¿”å›æ–‡æœ¬\");\n    return JSON.parse(response.text) as ScriptBreakdown;\n\n  } catch (error: any) {\n    console.error(\"AI Analysis Failed:\", error);\n    throw new Error(`å‰§æœ¬åˆ†æå¤±è´¥: ${error.message}`);\n  }\n};"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;AAEA,+DAA+D;AAC/D,qBAAqB;AACrB,+DAA+D;AAC/D,wCAA4C;IAC1C,IAAI;QACF,MAAM,WAAW;QACjB,MAAM,aAAa,IAAI,6IAAU,CAAC;QAClC,IAAA,sJAAmB,EAAC;IACtB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,WAAW;IAC3B;AACF;AAEA,MAAM,KAAK,IAAI,0KAAW,CAAC;IACzB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AAaO,MAAM,gBAAgB,OAAO;IAClC,MAAM,QAAQ;IAEd,sBAAsB;IACtB,MAAM,oBAAoB,CAAC;;;;;;;;;;;;EAY3B,CAAC;IAED,MAAM,iBAAyB;QAC7B,MAAM,mKAAI,CAAC,MAAM;QACjB,YAAY;YACV,QAAQ;gBACN,MAAM,mKAAI,CAAC,KAAK;gBAChB,OAAO;oBACL,MAAM,mKAAI,CAAC,MAAM;oBACjB,YAAY;wBACV,aAAa;4BAAE,MAAM,mKAAI,CAAC,MAAM;wBAAC;wBACjC,aAAa;4BAAE,MAAM,mKAAI,CAAC,MAAM;wBAAC;wBACjC,UAAU;4BAAE,MAAM,mKAAI,CAAC,MAAM;wBAAC;wBAC9B,cAAc;4BAAE,MAAM,mKAAI,CAAC,MAAM;wBAAC;wBAClC,SAAS;4BAAE,MAAM,mKAAI,CAAC,MAAM;wBAAC;oBAC/B;oBACA,UAAU;wBAAC;wBAAe;wBAAe;wBAAY;wBAAgB;qBAAU;gBACjF;YACF;QACF;QACA,UAAU;YAAC;SAAS;IACtB;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,GAAG,MAAM,CAAC,eAAe,CAAC;YAC/C;YACA,UAAU,CAAC,sBAAsB,EAAE,OAAO,CAAC,CAAC;YAC5C,QAAQ;gBACN;gBACA,kBAAkB;gBAClB;YACF;QACF;QAEA,IAAI,CAAC,SAAS,IAAI,EAAE,MAAM,IAAI,MAAM;QACpC,OAAO,KAAK,KAAK,CAAC,SAAS,IAAI;IAEjC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,MAAM,IAAI,MAAM,CAAC,QAAQ,EAAE,MAAM,OAAO,EAAE;IAC5C;AACF;;;IAzDa;;AAAA,+OAAA"}},
    {"offset": {"line": 344, "column": 0}, "map": {"version":3,"sources":["file:///Users/marc/AITUBE-NEW/marctubud-pixel-AITUBEV1/utils/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport async function createClient() {\n  // 1. ç­‰å¾… Cookie Store (Next.js 15 å¿…é¡»åŠ  await)\n  const cookieStore = await cookies()\n\n  // 2. æ‰“å°è°ƒè¯•æ—¥å¿—\n  const allCookies = cookieStore.getAll()\n  console.log(`ğŸª [Debug Server] æ”¶åˆ° Cookie æ•°é‡: ${allCookies.length}`)\n  \n  if (allCookies.length > 0) {\n    // æ‰“å°å‰ä¸¤ä¸ª Cookie çš„åå­—éªŒè¯ä¸€ä¸‹\n    console.log(`ğŸª [Debug Server] Cookie ç¤ºä¾‹: ${allCookies.slice(0, 2).map(c => c.name).join(', ')}`)\n  } else {\n    console.error(`âŒ [Debug Server] è­¦å‘Šï¼šæ²¡æœ‰æ”¶åˆ°ä»»ä½• Cookieï¼è®¤è¯å°†å¤±è´¥ã€‚`)\n  }\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        // ğŸ› ï¸ ä¿®å¤ç‚¹ï¼šåŠ å›äº† \": any\"ï¼Œé˜²æ­¢ TypeScript æŠ¥é”™\n        setAll(cookiesToSet: any) {\n          try {\n            // è¿™é‡Œçš„å‚æ•°ä¹Ÿè¦åŠ  \": any\"\n            cookiesToSet.forEach(({ name, value, options }: any) => {\n               // Server Action ä¸­é€šå¸¸ä¸éœ€è¦å®é™…å†™å…¥ Cookieï¼Œè¿™é‡Œç•™ç©ºæˆ–è€…æ˜¯ä¸ºäº†å…¼å®¹æ€§\n            })\n          } catch (error) {\n            // ignore\n          }\n        },\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,4CAA4C;IAC5C,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,YAAY;IACZ,MAAM,aAAa,YAAY,MAAM;IACrC,QAAQ,GAAG,CAAC,CAAC,gCAAgC,EAAE,WAAW,MAAM,EAAE;IAElE,IAAI,WAAW,MAAM,GAAG,GAAG;QACzB,uBAAuB;QACvB,QAAQ,GAAG,CAAC,CAAC,6BAA6B,EAAE,WAAW,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,EAAE,IAAI,CAAC,OAAO;IAClG,OAAO;QACL,QAAQ,KAAK,CAAC,CAAC,wCAAwC,CAAC;IAC1D;IAEA,OAAO,IAAA,+LAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,uCAAuC;YACvC,QAAO,YAAiB;gBACtB,IAAI;oBACF,mBAAmB;oBACnB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAO;oBAChD,+CAA+C;oBAClD;gBACF,EAAE,OAAO,OAAO;gBACd,SAAS;gBACX;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 388, "column": 0}, "map": {"version":3,"sources":["file:///Users/marc/AITUBE-NEW/marctubud-pixel-AITUBEV1/app/actions/generate.ts"],"sourcesContent":["'use server'\n\nimport { createClient } from '@/utils/supabase/server'\nimport { setGlobalDispatcher, ProxyAgent } from 'undici';\n\n// å¼ºåˆ¶ä»£ç†é…ç½® (ä¿ç•™ä¸åŠ¨)\nif (process.env.NODE_ENV === 'development') {\n  try {\n    const proxyUrl = 'http://127.0.0.1:7890';\n    const dispatcher = new ProxyAgent({\n      uri: proxyUrl,\n      connect: { timeout: 60000 }\n    });\n    setGlobalDispatcher(dispatcher);\n  } catch (err) {\n    console.error('ä»£ç†è®¾ç½®å¤±è´¥:', err);\n  }\n}\n\nconst delay = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\n\n// âœ… æ–°å¢å‚æ•°: isDraft (æ˜¯å¦ä¸ºè‰å›¾æ¨¡å¼)\nexport async function generateShotImage(shotId: string, prompt: string, projectId: string, isDraft: boolean = false) {\n  const supabase = await createClient();\n  const MAX_RETRIES = 3;\n  \n  for (let i = 0; i < MAX_RETRIES; i++) {\n    try {\n      // =========================================================\n      // ğŸ¨ æ ¸å¿ƒä¿®æ”¹ï¼šæ ¹æ®æ¨¡å¼é€‰æ‹©ä¸åŒçš„æ¨¡å‹å’Œç”»é£\n      // =========================================================\n      let finalPrompt = \"\";\n      let model = \"\";\n\n      if (isDraft) {\n        // âœï¸ çº¿ç¨¿æ¨¡å¼ï¼šé€Ÿåº¦å¿«ï¼Œé»‘ç™½è‰å›¾ï¼Œç‰¹å¾æ¸…æ™°\n        // ä½¿ç”¨ turbo æ¨¡å‹ (ç”Ÿæˆé€Ÿåº¦æå¿«)\n        model = \"turbo\"; \n        finalPrompt = encodeURIComponent(\n          prompt + \", rough storyboard sketch, pencil drawing, loose lines, minimal detail, black and white, thick strokes, high contrast, white background\"\n        );\n      } else {\n        // ğŸ¬ æ¸²æŸ“æ¨¡å¼ï¼šç”»è´¨é«˜ï¼Œå…‰å½±å¼º\n        // ä½¿ç”¨ flux æ¨¡å‹ (æ…¢ä½†ç²¾ç»†)\n        model = \"flux\"; \n        finalPrompt = encodeURIComponent(\n          prompt + \", cinematic lighting, 8k, photorealistic, movie scene, detailed texture, depth of field\"\n        );\n      }\n\n      const imageUrl = `https://image.pollinations.ai/prompt/${finalPrompt}?width=1280&height=720&model=${model}&seed=${Math.random()}&nologo=true`; \n\n      // 2. ä¸‹è½½å›¾ç‰‡\n      const response = await fetch(imageUrl, {\n        signal: AbortSignal.timeout(60000)\n      });\n      \n      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\n\n      const arrayBuffer = await response.arrayBuffer();\n      const imageBuffer = Buffer.from(arrayBuffer);\n\n      // 3. ä¸Šä¼ å­˜å‚¨æ¡¶\n      const fileName = `${projectId}/${shotId}_${Date.now()}.png`;\n      const { error: uploadError } = await supabase.storage.from('shots').upload(fileName, imageBuffer, {\n          contentType: 'image/png',\n          upsert: true\n      });\n\n      if (uploadError) throw new Error(\"ä¸Šä¼ å¤±è´¥\");\n\n      const { data: { publicUrl } } = supabase.storage.from('shots').getPublicUrl(fileName);\n\n      return { success: true, url: publicUrl };\n\n    } catch (error: any) {\n      console.warn(`Attempt ${i+1} failed:`, error.message);\n      if (i === MAX_RETRIES - 1) return { success: false, message: error.message };\n      await delay(1000);\n    }\n  }\n  return { success: false, message: \"Unknown error\" };\n}"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;AAEA,gBAAgB;AAChB,wCAA4C;IAC1C,IAAI;QACF,MAAM,WAAW;QACjB,MAAM,aAAa,IAAI,6IAAU,CAAC;YAChC,KAAK;YACL,SAAS;gBAAE,SAAS;YAAM;QAC5B;QACA,IAAA,sJAAmB,EAAC;IACtB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,WAAW;IAC3B;AACF;AAEA,MAAM,QAAQ,CAAC,KAAe,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;AAGlE,eAAe,kBAAkB,MAAc,EAAE,MAAc,EAAE,SAAiB,EAAE,UAAmB,KAAK;IACjH,MAAM,WAAW,MAAM,IAAA,2IAAY;IACnC,MAAM,cAAc;IAEpB,IAAK,IAAI,IAAI,GAAG,IAAI,aAAa,IAAK;QACpC,IAAI;YACF,4DAA4D;YAC5D,yBAAyB;YACzB,4DAA4D;YAC5D,IAAI,cAAc;YAClB,IAAI,QAAQ;YAEZ,IAAI,SAAS;gBACX,wBAAwB;gBACxB,uBAAuB;gBACvB,QAAQ;gBACR,cAAc,mBACZ,SAAS;YAEb,OAAO;gBACL,kBAAkB;gBAClB,oBAAoB;gBACpB,QAAQ;gBACR,cAAc,mBACZ,SAAS;YAEb;YAEA,MAAM,WAAW,CAAC,qCAAqC,EAAE,YAAY,6BAA6B,EAAE,MAAM,MAAM,EAAE,KAAK,MAAM,GAAG,YAAY,CAAC;YAE7I,UAAU;YACV,MAAM,WAAW,MAAM,MAAM,UAAU;gBACrC,QAAQ,YAAY,OAAO,CAAC;YAC9B;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,SAAS,MAAM,EAAE;YAE1E,MAAM,cAAc,MAAM,SAAS,WAAW;YAC9C,MAAM,cAAc,OAAO,IAAI,CAAC;YAEhC,WAAW;YACX,MAAM,WAAW,GAAG,UAAU,CAAC,EAAE,OAAO,CAAC,EAAE,KAAK,GAAG,GAAG,IAAI,CAAC;YAC3D,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,OAAO,CAAC,IAAI,CAAC,SAAS,MAAM,CAAC,UAAU,aAAa;gBAC9F,aAAa;gBACb,QAAQ;YACZ;YAEA,IAAI,aAAa,MAAM,IAAI,MAAM;YAEjC,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,GAAG,SAAS,OAAO,CAAC,IAAI,CAAC,SAAS,YAAY,CAAC;YAE5E,OAAO;gBAAE,SAAS;gBAAM,KAAK;YAAU;QAEzC,EAAE,OAAO,OAAY;YACnB,QAAQ,IAAI,CAAC,CAAC,QAAQ,EAAE,IAAE,EAAE,QAAQ,CAAC,EAAE,MAAM,OAAO;YACpD,IAAI,MAAM,cAAc,GAAG,OAAO;gBAAE,SAAS;gBAAO,SAAS,MAAM,OAAO;YAAC;YAC3E,MAAM,MAAM;QACd;IACF;IACA,OAAO;QAAE,SAAS;QAAO,SAAS;IAAgB;AACpD;;;IA5DsB;;AAAA,+OAAA"}},
    {"offset": {"line": 479, "column": 0}, "map": {"version":3,"sources":["file:///Users/marc/AITUBE-NEW/marctubud-pixel-AITUBEV1/.next-internal/server/app/tools/cineflow/storyboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {analyzeScript as '7fcf3a16334304d1e04a6c1130bcb6eee817055d48'} from 'ACTIONS_MODULE0'\nexport {generateShotImage as '7864ff3c51eedcf1e037d979362ec0d6ac5e7fa9c1'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AACA"}}]
}
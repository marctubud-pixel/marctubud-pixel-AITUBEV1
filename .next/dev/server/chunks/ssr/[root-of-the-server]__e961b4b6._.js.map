{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/marc/AITUBE-NEW/marctubud-pixel-AITUBEV1/app/actions/director.ts"],"sourcesContent":["'use server'\n\nimport { GoogleGenAI, Type, Schema } from \"@google/genai\";\n\n// âŒ åˆ æ‰äº†å¤æ‚çš„ä»£ç†ä»£ç ï¼Œå›å½’æœ€ç®€æ¨¡å¼\nconst ai = new GoogleGenAI({ \n  apiKey: process.env.GOOGLE_API_KEY\n});\n\n// å®šä¹‰è¿”å›çš„æ•°æ®ç»“æ„\nexport interface ScriptBreakdown {\n  panels: {\n    sceneNumber: string;\n    description: string;\n    shotType: string;\n    visualPrompt: string;\n  }[];\n}\n\nexport const analyzeScript = async (script: string): Promise<ScriptBreakdown> => {\n  // è¿™é‡Œä½¿ç”¨ Google çš„ 2.0 Flash æ¨¡å‹ï¼Œé€Ÿåº¦å¿«ä¸”å…è´¹\n  const model = \"gemini-2.0-flash-exp\"; \n  \n  const systemInstruction = `\n    You are a world-class Hollywood cinematographer and storyboard artist. \n    Your task is to analyze a short script and break it down into exactly 4 key visual panels (beats) for a 2x2 grid storyboard.\n    For each panel, determine the Shot Type (CS=Close Shot, MS=Medium Shot, LS=Long Shot).\n    Create a highly detailed Stable Diffusion style prompt for a black and white sketch style image.\n    The visual prompt must describe the scene content, the angle, the lighting, and strictly specify \"black and white ink sketch style\".\n  `;\n\n  const responseSchema: Schema = {\n    type: Type.OBJECT,\n    properties: {\n      panels: {\n        type: Type.ARRAY,\n        items: {\n          type: Type.OBJECT,\n          properties: {\n            sceneNumber: { type: Type.STRING },\n            description: { type: Type.STRING },\n            shotType: { type: Type.STRING },\n            visualPrompt: { type: Type.STRING },\n          },\n          required: [\"sceneNumber\", \"description\", \"shotType\", \"visualPrompt\"],\n        },\n      },\n    },\n    required: [\"panels\"],\n  };\n\n  try {\n    const response = await ai.models.generateContent({\n      model,\n      contents: `Analyze this script and generate a 4-panel breakdown: \"${script}\"`,\n      config: {\n        systemInstruction,\n        responseMimeType: \"application/json\",\n        responseSchema,\n      },\n    });\n\n    if (!response.text) {\n      throw new Error(\"Gemini æ²¡æœ‰è¿”å›æ–‡æœ¬\");\n    }\n\n    return JSON.parse(response.text) as ScriptBreakdown;\n\n  } catch (error: any) {\n    console.error(\"AI Analysis Failed:\", error);\n    throw new Error(`å‰§æœ¬åˆ†æå¤±è´¥: ${error.message}`);\n  }\n};"],"names":[],"mappings":";;;;;AAEA;;;;AAEA,sBAAsB;AACtB,MAAM,KAAK,IAAI,0KAAW,CAAC;IACzB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AAYO,MAAM,gBAAgB,OAAO;IAClC,oCAAoC;IACpC,MAAM,QAAQ;IAEd,MAAM,oBAAoB,CAAC;;;;;;EAM3B,CAAC;IAED,MAAM,iBAAyB;QAC7B,MAAM,mKAAI,CAAC,MAAM;QACjB,YAAY;YACV,QAAQ;gBACN,MAAM,mKAAI,CAAC,KAAK;gBAChB,OAAO;oBACL,MAAM,mKAAI,CAAC,MAAM;oBACjB,YAAY;wBACV,aAAa;4BAAE,MAAM,mKAAI,CAAC,MAAM;wBAAC;wBACjC,aAAa;4BAAE,MAAM,mKAAI,CAAC,MAAM;wBAAC;wBACjC,UAAU;4BAAE,MAAM,mKAAI,CAAC,MAAM;wBAAC;wBAC9B,cAAc;4BAAE,MAAM,mKAAI,CAAC,MAAM;wBAAC;oBACpC;oBACA,UAAU;wBAAC;wBAAe;wBAAe;wBAAY;qBAAe;gBACtE;YACF;QACF;QACA,UAAU;YAAC;SAAS;IACtB;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,GAAG,MAAM,CAAC,eAAe,CAAC;YAC/C;YACA,UAAU,CAAC,uDAAuD,EAAE,OAAO,CAAC,CAAC;YAC7E,QAAQ;gBACN;gBACA,kBAAkB;gBAClB;YACF;QACF;QAEA,IAAI,CAAC,SAAS,IAAI,EAAE;YAClB,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO,KAAK,KAAK,CAAC,SAAS,IAAI;IAEjC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,MAAM,IAAI,MAAM,CAAC,QAAQ,EAAE,MAAM,OAAO,EAAE;IAC5C;AACF;;;IArDa;;AAAA,+OAAA"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///Users/marc/AITUBE-NEW/marctubud-pixel-AITUBEV1/utils/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport async function createClient() {\n  // 1. ç­‰å¾… Cookie Store (Next.js 15 å¿…é¡»åŠ  await)\n  const cookieStore = await cookies()\n\n  // 2. æ‰“å°è°ƒè¯•æ—¥å¿—\n  const allCookies = cookieStore.getAll()\n  console.log(`ğŸª [Debug Server] æ”¶åˆ° Cookie æ•°é‡: ${allCookies.length}`)\n  \n  if (allCookies.length > 0) {\n    // æ‰“å°å‰ä¸¤ä¸ª Cookie çš„åå­—éªŒè¯ä¸€ä¸‹\n    console.log(`ğŸª [Debug Server] Cookie ç¤ºä¾‹: ${allCookies.slice(0, 2).map(c => c.name).join(', ')}`)\n  } else {\n    console.error(`âŒ [Debug Server] è­¦å‘Šï¼šæ²¡æœ‰æ”¶åˆ°ä»»ä½• Cookieï¼è®¤è¯å°†å¤±è´¥ã€‚`)\n  }\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        // ğŸ› ï¸ ä¿®å¤ç‚¹ï¼šåŠ å›äº† \": any\"ï¼Œé˜²æ­¢ TypeScript æŠ¥é”™\n        setAll(cookiesToSet: any) {\n          try {\n            // è¿™é‡Œçš„å‚æ•°ä¹Ÿè¦åŠ  \": any\"\n            cookiesToSet.forEach(({ name, value, options }: any) => {\n               // Server Action ä¸­é€šå¸¸ä¸éœ€è¦å®é™…å†™å…¥ Cookieï¼Œè¿™é‡Œç•™ç©ºæˆ–è€…æ˜¯ä¸ºäº†å…¼å®¹æ€§\n            })\n          } catch (error) {\n            // ignore\n          }\n        },\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,4CAA4C;IAC5C,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,YAAY;IACZ,MAAM,aAAa,YAAY,MAAM;IACrC,QAAQ,GAAG,CAAC,CAAC,gCAAgC,EAAE,WAAW,MAAM,EAAE;IAElE,IAAI,WAAW,MAAM,GAAG,GAAG;QACzB,uBAAuB;QACvB,QAAQ,GAAG,CAAC,CAAC,6BAA6B,EAAE,WAAW,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,EAAE,IAAI,CAAC,OAAO;IAClG,OAAO;QACL,QAAQ,KAAK,CAAC,CAAC,wCAAwC,CAAC;IAC1D;IAEA,OAAO,IAAA,+LAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,uCAAuC;YACvC,QAAO,YAAiB;gBACtB,IAAI;oBACF,mBAAmB;oBACnB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAO;oBAChD,+CAA+C;oBAClD;gBACF,EAAE,OAAO,OAAO;gBACd,SAAS;gBACX;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":["file:///Users/marc/AITUBE-NEW/marctubud-pixel-AITUBEV1/app/actions/generate.ts"],"sourcesContent":["'use server'\n\nimport { createClient } from '@/utils/supabase/server'\nimport { revalidatePath } from 'next/cache'\n\nexport async function generateShotImage(shotId: string, prompt: string, projectId: string) {\n  console.log(\"ğŸš€ [AI] å¼€å§‹ç”Ÿæˆé•œå¤´:\", shotId);\n\n  try {\n    const supabase = await createClient();\n\n    // 1. ä½¿ç”¨ Pollinations AI ç”Ÿæˆ (å…è´¹ã€æ— éœ€ Key)\n    // å®ƒæ˜¯é€šè¿‡ URL ç›´æ¥è¿”å›å›¾ç‰‡çš„ï¼Œéå¸¸æ–¹ä¾¿\n    // æˆ‘ä»¬å¯¹ prompt è¿›è¡Œç¼–ç ï¼Œé˜²æ­¢ç‰¹æ®Šå­—ç¬¦æŠ¥é”™\n    const encodedPrompt = encodeURIComponent(prompt + \", cinematic lighting, 8k, photorealistic\");\n    const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=1280&height=720&model=flux`; // ä½¿ç”¨ flux æ¨¡å‹ï¼Œæ•ˆæœæ›´å¥½\n\n    console.log(\"ğŸ¨ è¯·æ±‚ Pollinations:\", imageUrl);\n\n    // 2. ä¸‹è½½ç”Ÿæˆçš„å›¾ç‰‡ (è·å–äºŒè¿›åˆ¶æµ)\n    const response = await fetch(imageUrl);\n    \n    if (!response.ok) {\n        throw new Error(`å›¾ç‰‡ç”Ÿæˆå¤±è´¥: ${response.statusText}`);\n    }\n\n    const arrayBuffer = await response.arrayBuffer();\n    const imageBuffer = Buffer.from(arrayBuffer);\n\n    // 3. ä¸Šä¼ åˆ° Supabase Storage\n    const fileName = `${projectId}/${shotId}_${Date.now()}.png`;\n\n    const { data: uploadData, error: uploadError } = await supabase\n      .storage\n      .from('shots')\n      .upload(fileName, imageBuffer, {\n        contentType: 'image/png',\n        upsert: true\n      });\n\n    if (uploadError) {\n        console.error(\"Storage Upload Error:\", uploadError);\n        throw new Error(\"å›¾ç‰‡ä¸Šä¼ åˆ°å­˜å‚¨æ¡¶å¤±è´¥\");\n    }\n\n    // 4. è·å–å…¬å¼€é“¾æ¥\n    const { data: { publicUrl } } = supabase\n      .storage\n      .from('shots')\n      .getPublicUrl(fileName);\n\n    // 5. æ›´æ–°æ•°æ®åº“\n    const { error: dbError } = await supabase\n      .from('shots')\n      .update({\n        image_url: publicUrl,\n        status: 'completed'\n      })\n      .eq('id', shotId);\n\n    if (dbError) throw dbError;\n\n    console.log(\"âœ… [AI] ç”Ÿæˆå¹¶ä¸Šä¼ æˆåŠŸ:\", publicUrl);\n    return { success: true, url: publicUrl };\n\n  } catch (error: any) {\n    console.error(\"ğŸ”¥ [AI Fail]:\", error);\n    \n    // å¤±è´¥æ—¶è®°å½•çŠ¶æ€\n    const supabase = await createClient();\n    await supabase.from('shots').update({ status: 'failed' }).eq('id', shotId);\n\n    return { success: false, message: error.message };\n  }\n}\n"],"names":[],"mappings":";;;;;AAEA;;;;AAGO,eAAe,kBAAkB,MAAc,EAAE,MAAc,EAAE,SAAiB;IACvF,QAAQ,GAAG,CAAC,mBAAmB;IAE/B,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,2IAAY;QAEnC,uCAAuC;QACvC,wBAAwB;QACxB,2BAA2B;QAC3B,MAAM,gBAAgB,mBAAmB,SAAS;QAClD,MAAM,WAAW,CAAC,qCAAqC,EAAE,cAAc,iCAAiC,CAAC,EAAE,kBAAkB;QAE7H,QAAQ,GAAG,CAAC,uBAAuB;QAEnC,sBAAsB;QACtB,MAAM,WAAW,MAAM,MAAM;QAE7B,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,IAAI,MAAM,CAAC,QAAQ,EAAE,SAAS,UAAU,EAAE;QACpD;QAEA,MAAM,cAAc,MAAM,SAAS,WAAW;QAC9C,MAAM,cAAc,OAAO,IAAI,CAAC;QAEhC,0BAA0B;QAC1B,MAAM,WAAW,GAAG,UAAU,CAAC,EAAE,OAAO,CAAC,EAAE,KAAK,GAAG,GAAG,IAAI,CAAC;QAE3D,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SACpD,OAAO,CACP,IAAI,CAAC,SACL,MAAM,CAAC,UAAU,aAAa;YAC7B,aAAa;YACb,QAAQ;QACV;QAEF,IAAI,aAAa;YACb,QAAQ,KAAK,CAAC,yBAAyB;YACvC,MAAM,IAAI,MAAM;QACpB;QAEA,YAAY;QACZ,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,GAAG,SAC7B,OAAO,CACP,IAAI,CAAC,SACL,YAAY,CAAC;QAEhB,WAAW;QACX,MAAM,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,SACL,MAAM,CAAC;YACN,WAAW;YACX,QAAQ;QACV,GACC,EAAE,CAAC,MAAM;QAEZ,IAAI,SAAS,MAAM;QAEnB,QAAQ,GAAG,CAAC,mBAAmB;QAC/B,OAAO;YAAE,SAAS;YAAM,KAAK;QAAU;IAEzC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iBAAiB;QAE/B,UAAU;QACV,MAAM,WAAW,MAAM,IAAA,2IAAY;QACnC,MAAM,SAAS,IAAI,CAAC,SAAS,MAAM,CAAC;YAAE,QAAQ;QAAS,GAAG,EAAE,CAAC,MAAM;QAEnE,OAAO;YAAE,SAAS;YAAO,SAAS,MAAM,OAAO;QAAC;IAClD;AACF;;;IArEsB;;AAAA,+OAAA"}},
    {"offset": {"line": 312, "column": 0}, "map": {"version":3,"sources":["file:///Users/marc/AITUBE-NEW/marctubud-pixel-AITUBEV1/.next-internal/server/app/tools/cineflow/storyboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {analyzeScript as '7fcf3a16334304d1e04a6c1130bcb6eee817055d48'} from 'ACTIONS_MODULE0'\nexport {generateShotImage as '7064ff3c51eedcf1e037d979362ec0d6ac5e7fa9c1'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AACA"}}]
}
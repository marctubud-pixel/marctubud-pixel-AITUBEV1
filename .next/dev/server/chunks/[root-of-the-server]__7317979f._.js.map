{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/marc/AITUBE-NEW/marctubud-pixel-AITUBEV1/app/api/admin/bilibili-search/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const keyword = searchParams.get('keyword');\n    \n    // üç™ ‰Ω†ÁöÑ Cookie (ËØ∑Á°Æ‰øùËøôÈáåÊòØ‰Ω†ÊúÄÊñ∞ÁöÑ Cookie)\n    const MY_COOKIE = `buvid3=072E0F75-3433-544A-DDE5-E465B5E1387645399infoc; b_nut=1765896345; bsource=search_google; _uuid=12383B73-FE510-9F94-CE64-E337B39BD69445942infoc; buvid_fp=b719f562f0dc3417f678618b8d6db4de; buvid4=52C0D220-35EF-3A75-D090-DFFF7E0CE0DF47512-025121622-6jc0mVDKE58A4p9Unqyk4w%3D%3D; theme-tip-show=SHOWED; rpdid=|(Juu)kYRu||0J'u~Yl)mYRuJ; theme-avatar-tip-show=SHOWED; CURRENT_QUALITY=0; DedeUserID=38505796; DedeUserID__ckMd5=cb4054763ac8f0c9; bili_ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6InMwMyIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NjY5MzU3MTIsImlhdCI6MTc2NjY3NjQ1MiwicGx0IjotMX0.4iBFzhXpUYkJRcFJP2USRjoemOIE4kXOojDrCZOylMM; bili_ticket_expires=1766935652; b_lsid=EAE6FF6E_19B64591F88; SESSDATA=5b774545%2C1782470157%2Ca4f38%2Ac2CjCs6S-JV3ULy9Q0lvUydQ8n4ZDj5uLWtVTvrUH5DVdxpLsQx-shmnNxhA366q1OuocSVndJcHlRWVh1NVZmcHFhMkpsWU11a3BGQXBaZ1g4NnpsUzFsaDI4OERzWHVMSGRoUDZpR255WE5uYmNZcEx1UFZIZjB2TUtvMmdXUXdMUjBBVHRrNi1RIIEC; bili_jct=af51a72ba5871df6114c8bbd208d37f3; sid=52q9hcpu; home_feed_column=4; bp_t_offset_38505796=1151395648755466240; browser_resolution=657-668; CURRENT_FNVAL=4048`;\n\n    const targetUrl = `https://api.bilibili.com/x/web-interface/search/type?keyword=${encodeURIComponent(keyword || '')}&search_type=video&page=1&page_size=20`;\n\n    const headers = {\n      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\n      'Referer': 'https://www.bilibili.com/',\n      'Cookie': MY_COOKIE,\n    };\n\n    console.log(`\\n--- [START] ÂºÄÂßãËØ∑Ê±Ç BÁ´ô ---`);\n    console.log(`ÁõÆÊ†áURL: ${targetUrl}`);\n\n    const response = await fetch(targetUrl, { headers, cache: 'no-store' });\n    const data = await response.json();\n\n    console.log(`HTTPÁä∂ÊÄÅ: ${response.status}`);\n    console.log(`BÁ´ôËøîÂõûCode: ${data?.code} (0‰ª£Ë°®ÊàêÂäü)`);\n\n    // üî¨ ÊòæÂæÆÈïúÔºöÊâìÂç∞Êï∞ÊçÆÁªìÊûÑ keysÔºåÁúãÁúã result Âà∞Â∫ïÂéªÂì™‰∫Ü\n    if (data && data.data) {\n        const dataKeys = Object.keys(data.data);\n        console.log(`dataÂ±ÇÁöÑÂ≠óÊÆµ: [${dataKeys.join(', ')}]`);\n        \n        if (data.data.result) {\n            const resultType = Array.isArray(data.data.result) ? 'Êï∞ÁªÑ' : typeof data.data.result;\n            console.log(`resultÂ≠óÊÆµÁ±ªÂûã: ${resultType}`);\n            console.log(`resultÈïøÂ∫¶: ${data.data.result.length}`);\n            \n            // Â¶ÇÊûúÈïøÂ∫¶‰∏∫0ÔºåÂèØËÉΩÊòØË¢´È£éÊéßÈíàÂØπ‰∫ÜÔºàËΩØÊùÄÔºâ\n            if (data.data.result.length === 0) {\n                console.log('‚ùå ‰∏•ÈáçË≠¶ÂëäÔºöBÁ´ôËøîÂõû‰∫ÜÁ©∫Êï∞ÁªÑÔºÅËøôÈÄöÂ∏∏ÊÑèÂë≥ÁùÄ Cookie ËôΩÁÑ∂ËÉΩÁôªÂΩïÔºå‰ΩÜÊêúÁ¥¢ÂäüËÉΩË¢´È£éÊéßÈôêÂà∂‰∫Ü„ÄÇ');\n            }\n        } else {\n            console.log('‚ùå ‰∏•ÈáçË≠¶ÂëäÔºödata.result Â≠óÊÆµ‰∏çÂ≠òÂú®ÔºÅBÁ´ôÂèØËÉΩËøîÂõû‰∫ÜÈ™åËØÅÁ†ÅÁªìÊûÑ„ÄÇ');\n        }\n    } else {\n        console.log('‚ùå ‰∏•ÈáçË≠¶ÂëäÔºödata Â±ÇÂÆåÂÖ®‰∏çÂ≠òÂú®ÔºÅ');\n    }\n\n    const items = data?.data?.result || [];\n\n    // Ê∏ÖÊ¥óÊï∞ÊçÆ\n    const cleanedData = items.map((item: any) => ({\n      bvid: item.bvid,\n      title: item.title?.replace(/<[^>]+>/g, '') || 'Êó†Ê†áÈ¢ò',\n      author: item.author,\n      description: item.description,\n      pic: item.pic?.startsWith('//') ? `https:${item.pic}` : item.pic,\n      play: item.play,\n      duration: item.duration,\n      url: `https://www.bilibili.com/video/${item.bvid}`\n    }));\n\n    console.log(`ÊúÄÁªàÊ∏ÖÊ¥óÂá∫ ${cleanedData.length} Êù°Êï∞ÊçÆ`);\n    console.log(`--- [END] ËØ∑Ê±ÇÁªìÊùü ---\\n`);\n\n    return NextResponse.json({ \n      success: true, \n      count: cleanedData.length,\n      data: cleanedData,\n      // ÊääÂéüÂßã debug ‰ø°ÊÅØ‰πüËøîÂõûÁªôÂâçÁ´ØÔºåÊñπ‰æø‰Ω†Áúã\n      debug_raw: data \n    });\n\n  } catch (error: any) {\n    console.error('Spider Error:', error);\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,UAAU,aAAa,GAAG,CAAC;QAEjC,mCAAmC;QACnC,MAAM,YAAY,CAAC,kjCAAkjC,CAAC;QAEtkC,MAAM,YAAY,CAAC,6DAA6D,EAAE,mBAAmB,WAAW,IAAI,sCAAsC,CAAC;QAE3J,MAAM,UAAU;YACd,cAAc;YACd,WAAW;YACX,UAAU;QACZ;QAEA,QAAQ,GAAG,CAAC,CAAC,yBAAyB,CAAC;QACvC,QAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,WAAW;QAEjC,MAAM,WAAW,MAAM,MAAM,WAAW;YAAE;YAAS,OAAO;QAAW;QACrE,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,QAAQ,GAAG,CAAC,CAAC,QAAQ,EAAE,SAAS,MAAM,EAAE;QACxC,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,MAAM,KAAK,QAAQ,CAAC;QAE7C,qCAAqC;QACrC,IAAI,QAAQ,KAAK,IAAI,EAAE;YACnB,MAAM,WAAW,OAAO,IAAI,CAAC,KAAK,IAAI;YACtC,QAAQ,GAAG,CAAC,CAAC,WAAW,EAAE,SAAS,IAAI,CAAC,MAAM,CAAC,CAAC;YAEhD,IAAI,KAAK,IAAI,CAAC,MAAM,EAAE;gBAClB,MAAM,aAAa,MAAM,OAAO,CAAC,KAAK,IAAI,CAAC,MAAM,IAAI,OAAO,OAAO,KAAK,IAAI,CAAC,MAAM;gBACnF,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,YAAY;gBACvC,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,KAAK,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;gBAElD,uBAAuB;gBACvB,IAAI,KAAK,IAAI,CAAC,MAAM,CAAC,MAAM,KAAK,GAAG;oBAC/B,QAAQ,GAAG,CAAC;gBAChB;YACJ,OAAO;gBACH,QAAQ,GAAG,CAAC;YAChB;QACJ,OAAO;YACH,QAAQ,GAAG,CAAC;QAChB;QAEA,MAAM,QAAQ,MAAM,MAAM,UAAU,EAAE;QAEtC,OAAO;QACP,MAAM,cAAc,MAAM,GAAG,CAAC,CAAC,OAAc,CAAC;gBAC5C,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK,EAAE,QAAQ,YAAY,OAAO;gBAC9C,QAAQ,KAAK,MAAM;gBACnB,aAAa,KAAK,WAAW;gBAC7B,KAAK,KAAK,GAAG,EAAE,WAAW,QAAQ,CAAC,MAAM,EAAE,KAAK,GAAG,EAAE,GAAG,KAAK,GAAG;gBAChE,MAAM,KAAK,IAAI;gBACf,UAAU,KAAK,QAAQ;gBACvB,KAAK,CAAC,+BAA+B,EAAE,KAAK,IAAI,EAAE;YACpD,CAAC;QAED,QAAQ,GAAG,CAAC,CAAC,MAAM,EAAE,YAAY,MAAM,CAAC,IAAI,CAAC;QAC7C,QAAQ,GAAG,CAAC,CAAC,oBAAoB,CAAC;QAElC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO,YAAY,MAAM;YACzB,MAAM;YACN,0BAA0B;YAC1B,WAAW;QACb;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/marc/AITUBE-NEW/marctubud-pixel-AITUBEV1/app/api/fetch-bilibili/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const bvid = searchParams.get('bvid');\n\n  if (!bvid) return NextResponse.json({ error: 'Missing bvid' }, { status: 400 });\n\n  try {\n    const response = await fetch(`https://api.bilibili.com/x/web-interface/view?bvid=${bvid}`);\n    const data = await response.json();\n    if (data.code !== 0) return NextResponse.json({ error: data.message }, { status: 400 });\n    const info = data.data;\n\n    // Ëé∑ÂèñÊ†áÁ≠æ\n    const tagsResponse = await fetch(`https://api.bilibili.com/x/web-interface/view/detail/tag?bvid=${bvid}`);\n    const tagsData = await tagsResponse.json();\n    const tags = tagsData.data || [];\n\n    // üéØ Ê†∏ÂøÉÂçáÁ∫ßÔºöÊäìÂèñÊâÄÊúâÂåπÈÖçÁöÑÂ∑•ÂÖ∑Ôºå‰∏ç‰ªÖ‰ªÖÊòØÁ¨¨‰∏Ä‰∏™\n    const aiTools = ['Sora', 'Runway', 'Pika', 'Midjourney', 'Stable Diffusion', 'Luma', 'Kling', 'ÂèØÁÅµ', 'Âç≥Ê¢¶', 'Vidu', 'Gen-2', 'Gen-3', 'Flux', 'Hailuo', 'Êµ∑Ëû∫', 'ChatGPT', 'Claude', 'ElevenLabs', 'Sununo'];\n    \n    // ËøáÊª§Âá∫ÊâÄÊúâÂåπÈÖçÁöÑÊ†áÁ≠æ\n    const matchedTools = tags\n      .map((t: any) => t.tag_name)\n      .filter((tagName: string) => aiTools.some(tool => tagName.toLowerCase().includes(tool.toLowerCase())));\n    \n    // Â¶ÇÊûúÊ†áÁ≠æÈáåÊ≤°ÊâæÂà∞ÔºåÂÜçÂéªÊ†áÈ¢òÈáåÊâæ‰∏ÄÈÅç\n    if (matchedTools.length === 0) {\n        aiTools.forEach(tool => {\n            if (info.title.toLowerCase().includes(tool.toLowerCase())) {\n                matchedTools.push(tool);\n            }\n        });\n    }\n\n    // ÂéªÈáçÂπ∂ÂèñÂâç5‰∏™ÔºåÁî®ÈÄóÂè∑ËøûÊé•\n    const finalTag = Array.from(new Set(matchedTools)).slice(0, 5).join(', ') || 'AIËæÖÂä©';\n\n    // üïí Ê†∏ÂøÉÂçáÁ∫ßÔºöÂ§ÑÁêÜÊó∂Èïø\n    const durationStr = formatDuration(info.duration || 0);\n\n    return NextResponse.json({\n      title: info.title,\n      author: info.owner.name,\n      thumbnail_url: info.pic.replace('http:', 'https:'),\n      video_url: `https://player.bilibili.com/player.html?bvid=${bvid}&high_quality=1&autoplay=0`,\n      description: info.desc,\n      views: info.stat.view,\n      tag: finalTag,\n      duration: durationStr, // ‚úÖ Êñ∞Â¢ûÔºöËøîÂõûÊ†ºÂºèÂåñÂêéÁöÑÊó∂Èïø\n      // category ‰∏çËá™Âä®ËØÜÂà´ÔºåÁïôÁ©∫ÊàñÈªòËÆ§\n    });\n\n  } catch (error) {\n    return NextResponse.json({ error: 'Server Error' }, { status: 500 });\n  }\n}\n\n// üõ†Ô∏è Â∑•ÂÖ∑ÂáΩÊï∞ÔºöÂ∞ÜÁßíÊï∞ËΩ¨Êç¢‰∏∫ MM:SS Êàñ HH:MM:SS\nfunction formatDuration(seconds: number): string {\n  const h = Math.floor(seconds / 3600);\n  const m = Math.floor((seconds % 3600) / 60);\n  const s = seconds % 60;\n\n  // Â¶ÇÊûúË∂ÖËøá1Â∞èÊó∂ÔºåÊòæÁ§∫ HH:MM:SS\n  if (h > 0) {\n    return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\n  }\n  // Âê¶ÂàôÊòæÁ§∫ MM:SS\n  return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,IAAI,OAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;IAE9B,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;IAE7E,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,CAAC,mDAAmD,EAAE,MAAM;QACzF,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,IAAI,KAAK,IAAI,KAAK,GAAG,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,KAAK,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;QACrF,MAAM,OAAO,KAAK,IAAI;QAEtB,OAAO;QACP,MAAM,eAAe,MAAM,MAAM,CAAC,8DAA8D,EAAE,MAAM;QACxG,MAAM,WAAW,MAAM,aAAa,IAAI;QACxC,MAAM,OAAO,SAAS,IAAI,IAAI,EAAE;QAEhC,4BAA4B;QAC5B,MAAM,UAAU;YAAC;YAAQ;YAAU;YAAQ;YAAc;YAAoB;YAAQ;YAAS;YAAM;YAAM;YAAQ;YAAS;YAAS;YAAQ;YAAU;YAAM;YAAW;YAAU;YAAc;SAAS;QAExM,aAAa;QACb,MAAM,eAAe,KAClB,GAAG,CAAC,CAAC,IAAW,EAAE,QAAQ,EAC1B,MAAM,CAAC,CAAC,UAAoB,QAAQ,IAAI,CAAC,CAAA,OAAQ,QAAQ,WAAW,GAAG,QAAQ,CAAC,KAAK,WAAW;QAEnG,oBAAoB;QACpB,IAAI,aAAa,MAAM,KAAK,GAAG;YAC3B,QAAQ,OAAO,CAAC,CAAA;gBACZ,IAAI,KAAK,KAAK,CAAC,WAAW,GAAG,QAAQ,CAAC,KAAK,WAAW,KAAK;oBACvD,aAAa,IAAI,CAAC;gBACtB;YACJ;QACJ;QAEA,gBAAgB;QAChB,MAAM,WAAW,MAAM,IAAI,CAAC,IAAI,IAAI,eAAe,KAAK,CAAC,GAAG,GAAG,IAAI,CAAC,SAAS;QAE7E,eAAe;QACf,MAAM,cAAc,eAAe,KAAK,QAAQ,IAAI;QAEpD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO,KAAK,KAAK;YACjB,QAAQ,KAAK,KAAK,CAAC,IAAI;YACvB,eAAe,KAAK,GAAG,CAAC,OAAO,CAAC,SAAS;YACzC,WAAW,CAAC,6CAA6C,EAAE,KAAK,0BAA0B,CAAC;YAC3F,aAAa,KAAK,IAAI;YACtB,OAAO,KAAK,IAAI,CAAC,IAAI;YACrB,KAAK;YACL,UAAU;QAEZ;IAEF,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF;AAEA,mCAAmC;AACnC,SAAS,eAAe,OAAe;IACrC,MAAM,IAAI,KAAK,KAAK,CAAC,UAAU;IAC/B,MAAM,IAAI,KAAK,KAAK,CAAC,AAAC,UAAU,OAAQ;IACxC,MAAM,IAAI,UAAU;IAEpB,sBAAsB;IACtB,IAAI,IAAI,GAAG;QACT,OAAO,GAAG,EAAE,CAAC,EAAE,EAAE,QAAQ,GAAG,QAAQ,CAAC,GAAG,KAAK,CAAC,EAAE,EAAE,QAAQ,GAAG,QAAQ,CAAC,GAAG,MAAM;IACjF;IACA,aAAa;IACb,OAAO,GAAG,EAAE,QAAQ,GAAG,QAAQ,CAAC,GAAG,KAAK,CAAC,EAAE,EAAE,QAAQ,GAAG,QAAQ,CAAC,GAAG,MAAM;AAC5E"}}]
}